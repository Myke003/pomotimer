(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function o(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(t){if(t.ep)return;t.ep=!0;const i=o(t);fetch(t.href,i)}})();class m{constructor(e){this.initialTime=e,this.time=e,this.interval=null,this.isRunning=!1,this.isPaused=!1,this.clock=document.getElementById("time-string"),this.ring=new Audio("timer-done.mp3"),this.startTimestamp=0,this.pausedTimeRemaining=0,this.ring.addEventListener("error",o=>{console.log("Error al cargar el archivo de audio",o)}),this.showTime()}reset(){this.isRunning&&this.pause(),this.time=this.initialTime,this.isPaused=!1,this.pausedTimeRemaining=0,this.showTime()}start(){if(this.isRunning)return;this.isRunning=!0,this.isPaused=!1,this.pausedTimeRemaining>0&&(this.time=this.pausedTimeRemaining,this.pausedTimeRemaining=0),this.startTimestamp=Date.now();const e=this.startTimestamp+this.time*1e3;this.interval=setInterval(()=>{const o=Date.now(),r=Math.max(0,Math.floor((e-o)/1e3));r!==this.time&&(this.time=r,this.showTime(),this.time<=0&&(this.finish(),this.ring.play().catch(t=>console.log("Error al reproducir sonido",t))))},250)}pause(){this.isRunning&&(clearInterval(this.interval),this.isRunning=!1,this.isPaused=!0,this.pausedTimeRemaining=this.time)}finish(){clearInterval(this.interval),this.isRunning=!1,this.isPaused=!1,this.time=0,this.showTime(),setTimeout(()=>{this.time=this.initialTime,this.showTime()},1e3)}showTime(){const e=Math.floor(this.time/60),o=this.time%60;this.clock&&(this.clock.textContent=`${e<10?"0"+e:e}:${o<10?"0"+o:o}`)}toggleStartPause(){this.isRunning?this.pause():this.start()}destroy(){this.interval&&clearInterval(this.interval)}}document.addEventListener("DOMContentLoaded",()=>{const c=document.getElementById("pomodoro"),e=document.getElementById("short-break"),o=document.getElementById("long-break"),r=document.getElementById("timer-btn");if(!c||!e||!o||!r){console.error("No se pudieron encontrar todos los elementos necesarios en el DOM");return}const t=new m(25*60),i=new m(5*60),a=new m(15*60);let s=t;function h(){s&&(s.pause(),s.reset())}function u(){s&&s.isRunning?r.textContent="Pause":r.textContent="Start"}function d(n){h(),s=n,s.showTime(),u()}function f(n){document.querySelectorAll(".pomo-btn").forEach(g=>g.classList.remove("pomo-btn-active")),n.classList.add("pomo-btn-active")}r.addEventListener("click",()=>{s.toggleStartPause(),u()}),[{button:c,timer:t},{button:e,timer:i},{button:o,timer:a}].forEach(({button:n,timer:l})=>{n.addEventListener("click",()=>{d(l),f(n)})}),t.showTime(),u(),window.addEventListener("storage",n=>{n.key==="timer-heartbeat"&&s&&s.isRunning&&s.showTime()}),setInterval(()=>{s&&s.isRunning&&localStorage.setItem("timer-heartbeat",Date.now().toString())},1e3),window.addEventListener("beforeunload",()=>{[t,i,a].forEach(n=>{n&&n.destroy()})}),document.addEventListener("contextmenu",function(n){n.preventDefault()},!1)});
